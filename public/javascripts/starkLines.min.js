/*! Stark Lines v1.0.0 03-03-2014 */
function handleClientLoad(){gapi.client.setApiKey(apiKey),window.setTimeout(checkAuth,1)}function checkAuth(){gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!0},handleAuthResult)}function handleAuthResult(a){var b=document.getElementById("authorize-button");a&&!a.error?(b&&(b.style.visibility="hidden"),gapi.client.load("analytics","v3",makeApiCall)):b&&(b.style.visibility="",b.onclick=handleAuthClick)}function handleAuthClick(){return gapi.auth.authorize({client_id:clientId,scope:scopes,immediate:!1},handleAuthResult),!1}function makeApiCall(){queryAccounts()}function queryAccounts(){gapi.client.analytics.management.accounts.list().execute(handleAccounts)}function queryWebproperties(a){gapi.client.analytics.management.webproperties.list({accountId:a}).execute(handleWebproperties)}function queryProfiles(a,b){gapi.client.analytics.management.profiles.list({accountId:a,webPropertyId:b}).execute(handleProfiles)}function queryLiveReportingApi(a){var b=gapi.client.analytics.data.realtime.get({ids:"ga:"+a,metrics:"ga:activeVisitors",dimensions:"ga:pageTitle"});b.execute(handleLiveReportingResults)}function printResults(a){a.rows&&a.rows.length?console.log(a):console.log("No results found for ",a.profileInfo.profileName)}function handleAccounts(a){if(a.code)alert("There was an error querying accounts: "+a.message);else if(a&&a.items&&a.items.length){var b="<p>Choose an account</p><ul>";for(i=0;i<a.items.length;i++)b+='<li><a href="#chosen-account" onClick="queryWebproperties('+a.items[i].id+')">'+a.items[i].name+"</a></li>";b+='<ul><p><small>Or, you can drag and drop a Stark Lines configuration file anywhere on this page.<br><a href="http://www.bckmn.com/blog/even-starker-lines" target="_blank">You can read more here.</a></small></p>',optionsDiv.innerHTML=b}else console.log("No accounts found for this user."),optionsDiv.innerHTML+="<p>No accounts found for this user.</p>"}function handleWebproperties(a){if(a.code)alert("There was an error querying webproperties: "+a.message);else if(a&&a.items&&a.items.length){var b="<p>Choose a web property</p><ul>";for(i=0;i<a.items.length;i++)b+='<li><a href="#chosen-property" onClick="queryProfiles(\''+a.items[i].accountId+"','"+a.items[i].id+"')\">"+a.items[i].name+"</a></li>";b+='<ul><small>Or, you can drag and drop a Stark Lines configuration file anywhere on this page.<br><a href="http://www.bckmn.com/blog/even-starker-lines" target="_blank">You can read more here.</a></small></p>',optionsDiv.innerHTML=b,document.getElementById("reload-button").className=""}else console.log("No webproperties found for this account."),optionsDiv.innerHTML+="<p>No webproperties found for this account.</p>"}function handleProfiles(a){if(a.code)alert("There was an error querying views (profiles): "+a.message);else if(a&&a.items&&a.items.length){var b="<p>Finally, choose a profile</p><ul>";for(i=0;i<a.items.length;i++)b+='<li><a href="#chosen-profile" onClick="addProfile('+a.items[i].id+",'"+a.items[i].name+"')\">"+a.items[i].name+"</a></li>";b+='<ul><p><small>Or, you can drag and drop a Stark Lines configuration file anywhere on this page.<br><a href="http://www.bckmn.com/blog/even-starker-lines" target="_blank">You can read more here.</a></small></p>',optionsDiv.innerHTML=b}else console.log("No views (profiles) found for this account."),optionsDiv.innerHTML+="<p>No views (profiles) found for this account.</p>"}function handleLiveReportingResults(a){a.error?(alert("There was an error querying core reporting API: "+a.message),clearInterval(siteBeat.runningInterval)):pushResults(a)}function handleDownloadCreation(){window.URL=window.URL||window.webkitURL;var a=JSON.stringify(window.siteBeat.profileList),b=new Blob([a],{type:"application/json"}),c=document.getElementById("download-button"),d=new Date;c.style.visibility="visible",c.href=window.URL.createObjectURL(b),c.download=["stark_lines_config_",d.getFullYear().toString(),"_",(d.getMonth()+1).toString(),"_",d.getDate().toString(),".json"].join("")}function addProfile(a,b){var c=document.getElementById("reload-button"),d=document.getElementById("counters"),e=d.children.length;c.innerHTML="Add Profile",c.onclick=function(){queryAccounts()},optionsDiv.innerHTML=null,d.innerHTML+='<div class="pure-u-1-5"><span style="float:right;display:none;cursor:pointer;">X</span><a target="_blank" id="'+a.toString()+'-link"><div class="borders" style="border-color:'+color(siteBeat.profileList.length)+';"><h2 class="live-name">'+b+'</h2></div><div class="live-counter" style="background-color:'+color(siteBeat.profileList.length)+';"><span id="'+a.toString()+'-counter" class="odometer odometer-theme-default">0</span></div><small class="live-top" id="'+a.toString()+'-top"></small></a></div>',d.children[e].onmouseover=function(){this.children[0].style.display="inline"},d.children[e].onmouseout=function(){this.children[0].style.display="none"},d.children[e].children[0].onclick=function(){var a=confirm("Remove this profile?");if(a===!0){var b=[].indexOf.call(this.parentNode.parentNode.children,this.parentNode);siteBeat.profileList.splice(b,1),siteBeat.data[b]=d3.range(60).map(window.initial),siteBeat.allData[b]=d3.range(60).map(window.initial),this.parentNode.parentNode.removeChild(this.parentNode)}},siteBeat.profileList.indexOf?-1==siteBeat.profileList.indexOf(a)&&siteBeat.profileList.push({id:a,name:b}):siteBeat.profileList.push({id:a,name:b}),siteBeat.running===!1&&runnable(),siteBeat.profileList.length==siteBeat.data.length&&(c.style.display="none"),setTimeout(handleDownloadCreation,1)}function pushResults(a){var b=0;for(i=0;i<siteBeat.data.length;i++){if(siteBeat.data[i][59].profileId==a.profileInfo.profileId)return b=i,pusher(b,a),void 0;if(""===siteBeat.data[i][59].profileId)return b=i,pusher(b,a),void 0}}function pusher(a,b){b.rows&&b.rows.sort(function(a,b){return parseInt(b[1],10)-parseInt(a[1],10)});var c=b.rows?d3.sum(b.rows,function(a){return parseInt(a[1],10)}):0,d=document.getElementById(b.profileInfo.profileId.toString()+"-counter");d.innerHTML=c,d=document.getElementById(b.profileInfo.profileId.toString()+"-top"),d.innerHTML=b.rows?b.rows[0][0].substring(0,40)+"... "+b.rows[0][1]:"",d=document.getElementById(b.profileInfo.profileId.toString()+"-link"),d.href||(d.href="https://www.google.com/analytics/web/?hl=en#realtime/rt-overview/a"+b.profileInfo.accountId.toString()+"w"+b.profileInfo.internalWebPropertyId.toString()+"p"+b.profileInfo.profileId.toString()),siteBeat.data[a].shift(),siteBeat.data[a].push({time:(new Date).getTime(),value:c,profileName:b.profileInfo.profileName,profileId:b.profileInfo.profileId}),siteBeat.allData[a].push({time:(new Date).getTime(),value:c,profileName:b.profileInfo.profileName,profileId:b.profileInfo.profileName})}var clientId="248017327299",apiKey="AIzaSyA1TucEclEzMXJpeg9wL6ivbwDDbDPXZeU",scopes="https://www.googleapis.com/auth/analytics.readonly";window.onload=function(){handleClientLoad()};var optionsDiv=document.getElementById("options"),initial=function(){return{time:(new Date).getTime(),value:0,profileName:"",profileId:""}};window.siteBeat={data:d3.range(30).map(function(){return d3.range(60).map(initial)}),allData:d3.range(30).map(function(){return[]}),profileList:[],running:!1,delay:1e4,counterList:[],runningInterval:null};var x=d3.scale.linear().domain([1,siteBeat.data[0].length-2]).range([0,window.innerWidth]),y=d3.scale.linear().domain([0,d3.max(siteBeat.data,function(a){return a.value})]).rangeRound([0,h]),line=d3.svg.line().x(function(a,b){return x(b)}).y(function(a){return h-y(a.value)-.5}).interpolate("basis"),w=window.innerWidth/siteBeat.data[0].length,h=window.innerHeight/2,color=function(a){return["#00A0B0","#6A4A3C","#CC333F","#EB6841","#EDC951","#3B2D38","#F02475","#F27435","#CFBE27","#BCBDAC","#413E4A","#73626E","#B38184","#F0B49E","#F7E4BE","#8C2318","#5E8C6A","#88A65E","#BFB35A","#F2C45A"][a]},chart=d3.select("#graph1").append("svg").attr("class","chart").attr("width",w*siteBeat.data[0].length-1).attr("height",h),divvy=d3.select("#divvy"),runnable=function(){for(siteBeat.running=!0,i=0;i<siteBeat.data.length;i++)chart.append("path").attr("id","myPath"+i.toString()).attr("stroke",color(i)).attr("stroke-width",3).attr("fill","none").attr("d",line(siteBeat.data[i]));for(i=0;i<siteBeat.profileList.length;i++)setTimeout(queryLiveReportingApi,110,siteBeat.profileList[i].id);redraw(),siteBeat.runningInterval=setInterval(function(){for(i=0;i<siteBeat.profileList.length;i++)setTimeout(queryLiveReportingApi,110,siteBeat.profileList[i].id);redraw(),d3.timer.flush()},siteBeat.delay)},redraw=function(){for(y=d3.scale.linear().domain([0,1+parseInt(d3.max(siteBeat.data,function(a){return d3.max(a,function(a){return parseInt(a.value,10)})}),10)]).rangeRound([0,h]),i=0;i<siteBeat.data.length;i++)chart.selectAll("#myPath"+i.toString()).attr("d",line(siteBeat.data[i])).attr("transform","translate("+x(1)+")").transition().ease("linear").duration(siteBeat.delay-50).attr("transform","translate("+x(0)+")")};!function(){function a(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function b(a){var b=0,c=a.length;for(window.siteBeat.profileList=[],window.siteBeat.data=d3.range(30).map(function(){return d3.range(60).map(window.initial)}),window.siteBeat.allData=d3.range(30).map(function(){return[]}),document.getElementById("counters").innerHTML=null;c>b;b++)addProfile(a[b].id,a[b].name)}function c(a){function c(){return function(){return function(a){var c=JSON.parse(a.target.result);b(c)}}(d)}if(a.stopPropagation(),a.preventDefault(),window.File&&window.FileReader&&window.FileList&&window.Blob)for(var d,e=a.dataTransfer.files,f=0;f<e.length;f++)if(d=e[f],d.type.match("application/json")||d.type.match("")){var g=new FileReader;g.onload=c(),g.readAsText(d)}else alert("You're gonna need to upload a valid JSON file to configure this baby!\nCurrently, you are uploading a file of type \""+d.type.toString()+'."');else alert("Javascript File APIs are not fully supported in this here browser.\n Ya'll have to manually add profiles!")}var d=document.getElementsByTagName("body")[0];d.addEventListener("dragover",a,!1),d.addEventListener("drop",c,!1)}();var gapi=window.gapi=window.gapi||{};gapi._bs=(new Date).getTime(),function(){var a,b=encodeURIComponent,c=window,d=decodeURIComponent,e="push",f="test",g="shift",h="replace",i="length",j="split",k="join",l=c,m=document,n=l.location,o=function(){},p=/\[native code\]/,q=function(a,b,c){return a[b]=a[b]||c},r=function(a){for(var b=0;b<this[i];b++)if(this[b]===a)return b;return-1},s=function(a){a=a.sort();for(var b=[],c=void 0,d=0;d<a[i];d++){var f=a[d];f!=c&&b[e](f),c=f}return b},t=function(){var a;if((a=Object.create)&&p[f](a))a=a(null);else{a={};for(var b in a)a[b]=void 0}return a},u=q(l,"gapi",{});a=q(l,"___jsl",t()),q(a,"I",0),q(a,"hel",10);var v=function(){var b,c=n.href;if(a.dpo)b=a.h;else{b=a.h;var e=RegExp("([#].*&|[#])jsh=([^&#]*)","g"),f=RegExp("([?#].*&|[?#])jsh=([^&#]*)","g");if(c=c&&(e.exec(c)||f.exec(c)))try{b=d(c[2])}catch(g){}}return b},w=function(b){var c=q(a,"PQ",[]);a.PQ=[];var d=c[i];if(0===d)b();else for(var e=0,f=function(){++e===d&&b()},g=0;d>g;g++)c[g](f)},x=function(b){return q(q(a,"H",t()),b,t())},y=q(a,"perf",t()),z=q(y,"g",t()),A=q(y,"i",t());q(y,"r",[]),t(),t();var B=function(a,b,c){var d=y.r;"function"==typeof d?d(a,b,c):d[e]([a,b,c])},C=function(a,b,c){b&&0<b[i]&&(b=D(b),c&&0<c[i]&&(b+="___"+D(c)),28<b[i]&&(b=b.substr(0,28)+(b[i]-28)),c=b,b=q(A,"_p",t()),q(b,c,t())[a]=(new Date).getTime(),B(a,"_p",c))},D=function(a){return a[k]("__")[h](/\./g,"_")[h](/\-/g,"_")[h](/\,/g,"_")},E=t(),F=[],G=function(a){throw Error("Bad hint"+(a?": "+a:""))};F[e](["jsl",function(b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=b[c];"object"==typeof d?a[c]=q(a,c,[]).concat(d):q(a,c,d)}(c=b.u)&&(b=q(a,"us",[]),b[e](c),(c=/^https:(.*)$/.exec(c))&&b[e]("http:"+c[1]))}]);var H=/^(\/[a-zA-Z0-9_\-]+)+$/,I=/^[a-zA-Z0-9\-_\.!]+$/,J=/^gapi\.loaded_[0-9]+$/,K=/^[a-zA-Z0-9,._-]+$/,L=function(a,b,c,d){var e=a[j](";"),h=E[e[g]()],k=null;return h&&(k=h(e,b,c,d)),(b=k)&&(b=k,c=b.match(S),d=b.match(R),b=!!d&&1===d[i]&&Q[f](b)&&!!c&&1===c[i]),b||G(a),k},M=function(a,c,d,e){a=N(a),J[f](d)||G("invalid_callback"),c=O(c),e=e&&e[i]?O(e):null;var g=function(a){return b(a)[h](/%2C/g,",")};return[b(a.d)[h](/%2C/g,",")[h](/%2F/g,"/"),"/k=",g(a.version),"/m=",g(c),e?"/exm="+g(e):"","/rt=j/sv=1/d=1/ed=1",a.a?"/am="+g(a.a):"",a.b?"/rs="+g(a.b):"","/cb=",g(d)][k]("")},N=function(a){"/"!==a.charAt(0)&&G("relative path");for(var b=a.substring(1)[j]("/"),c=[];b[i];){if(a=b[g](),a[i]&&0!=a.indexOf(".")){if(0<a.indexOf("=")){b.unshift(a);break}}else G("empty/relative directory");c[e](a)}a={};for(var h=0,l=b[i];l>h;++h){var m=b[h][j]("="),n=d(m[0]),o=d(m[1]);2==m[i]&&n&&o&&(a[n]=a[n]||o)}return b="/"+c[k]("/"),H[f](b)||G("invalid_prefix"),c=P(a,"k",!0),h=P(a,"am"),a=P(a,"rs"),{d:b,version:c,a:h,b:a}},O=function(a){for(var b=[],c=0,d=a[i];d>c;++c){var g=a[c][h](/\./g,"_")[h](/-/g,"_");K[f](g)&&b[e](g)}return b[k](",")},P=function(a,b,c){if(a=a[b],!a&&c&&G("missing: "+b),a){if(I[f](a))return a;G("invalid: "+b)}return null},Q=/^https?:\/\/[a-z0-9_.-]+\.google\.com(:\d+)?\/[a-zA-Z0-9_.,!=\-\/]+$/,R=/\/cb=/g,S=/\/\//g,T=function(){var a=v();if(!a)throw Error("Bad hint");return a};E.m=function(a,b,c,d){return(a=a[0])||G("missing_hint"),"https://apis.google.com"+M(a,b,c,d)};var U=decodeURI("%73cript"),V=function(a,b){for(var c=[],d=0;d<a[i];++d){var f=a[d];f&&0>r.call(b,f)&&c[e](f)}return c},W=function(a){"loading"!=m.readyState?X(a):m.write("<"+U+' src="'+encodeURI(a)+'"></'+U+">")},X=function(a){var b=m.createElement(U);b.setAttribute("src",a),b.async="true",(a=m.getElementsByTagName(U)[0])?a.parentNode.insertBefore(b,a):(m.head||m.body||m.documentElement).appendChild(b)},Y=function(a,b){var c=b&&b._c;if(c)for(var d=0;d<F[i];d++){var e=F[d][0],f=F[d][1];f&&Object.prototype.hasOwnProperty.call(c,e)&&f(c[e],a,b)}},Z=function(a,b){ab(function(){var c;c=b===v()?q(u,"_",t()):t(),c=q(x(b),"_",c),a(c)})},$=function(b,c){var d=c||{};"function"==typeof c&&(d={},d.callback=c),Y(b,d);var f=b?b[j](":"):[],h=d.h||T(),k=q(a,"ah",t());if(k["::"]&&f[i]){for(var l=[],m=null;m=f[g]();){var n=m[j]("."),n=k[m]||k[n[1]&&"ns:"+n[0]||""]||h,o=l[i]&&l[l[i]-1]||null,p=o;o&&o.hint==n||(p={hint:n,c:[]},l[e](p)),p.c[e](m)}var r=l[i];if(r>1){var s=d.callback;s&&(d.callback=function(){0==--r&&s()})}for(;f=l[g]();)_(f.c,d,f.hint)}else _(f||[],d,h)},_=function(b,c,d){b=s(b)||[];var f=c.callback,g=c.config,h=c.timeout,j=c.ontimeout,k=null,m=!1;if(h&&!j||!h&&j)throw"Timeout requires both the timeout parameter and ontimeout parameter to be set";var n=q(x(d),"r",[]).sort(),p=q(x(d),"L",[]).sort(),r=[].concat(n),t=function(b,c){if(m)return 0;l.clearTimeout(k),p[e].apply(p,v);var f=((u||{}).config||{}).update;if(f?f(g):g&&q(a,"cu",[])[e](g),c){C("me0",b,r);try{Z(c,d)}finally{C("me1",b,r)}}return 1};h>0&&(k=l.setTimeout(function(){m=!0,j()},h));var v=V(b,p);if(v[i]){var v=V(b,n),y=q(a,"CP",[]),z=y[i];if(y[z]=function(a){if(!a)return 0;C("ml1",v,r);var b=function(b){y[z]=null,t(v,a)&&w(function(){f&&f(),b()})},c=function(){var a=y[z+1];a&&a()};z>0&&y[z-1]?y[z]=function(){b(c)}:b(c)},v[i]){var A="loaded_"+a.I++;u[A]=function(a){y[z](a),u[A]=null},b=L(d,v,"gapi."+A,n),n[e].apply(n,v),C("ml0",v,r),c.sync||l.___gapisync?W(b):X(b)}else y[z](o)}else t(v)&&f&&f()},ab=function(b){if(!(a.hee&&0<a.hel))return b();try{return b()}catch(d){a.hel--,$("debug_error",function(){try{c.___jsl.hefn(d)}catch(a){throw d}})}};u.load=function(a,b){return ab(function(){return $(a,b)})},z.bs0=c.gapi._bs||(new Date).getTime(),B("bs0"),z.bs1=(new Date).getTime(),B("bs1"),delete c.gapi._bs}(),gapi.load("client",{callback:window.gapi_onload,_c:{jsl:{ci:{"":{enableMultilogin:!1},client:{cors:!1},plus_layer:{isEnabled:!1},isLoggedIn:!0,iframes:{additnow:{methods:["launchurl"],url:"https://apis.google.com/additnow/additnow.html?bsv=o"},plus_followers:{params:{url:""},url:":socialhost:/_/im/_/widget/render/plus/followers?bsv=o"},signin:{methods:["onauth"],params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/signin?bsv=o"},commentcount:{url:":socialhost:/:session_prefix:_/widget/render/commentcount?bsv=o"},plus_circle:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/plus/circle?bsv=o"},hangout:{url:"https://talkgadget.google.com/:session_prefix:talkgadget/_/widget?bsv=o"},evwidget:{params:{url:""},url:":socialhost:/:session_prefix:_/events/widget?bsv=o"},zoomableimage:{url:"https://ssl.gstatic.com/microscope/embed/?bsv=o"},card:{url:":socialhost:/:session_prefix:_/hovercard/card?bsv=o"},shortlists:{url:"?bsv=o"},plus:{methods:["onauth"],url:":socialhost:/u/:session_index:/_/pages/badge?bsv=o"},":socialhost:":"https://apis.google.com",rbr_s:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/recobarsimplescroller?bsv=o"},autocomplete:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/autocomplete?bsv=o"},plus_share:{params:{url:""},url:":socialhost:/:session_prefix:_/+1/sharebutton?plusShare=true&bsv=o"},":source:":"3p",rbr_i:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/recobarinvitation?bsv=o"},panoembed:{url:"https://ssl.gstatic.com/pano/embed/?bsv=o"},savetowallet:{url:"https://clients5.google.com/s2w/o/savetowallet?bsv=o"},appcirclepicker:{url:":socialhost:/:session_prefix:_/widget/render/appcirclepicker?bsv=o"},savetodrive:{methods:["save"],url:"https://drive.google.com/savetodrivebutton?usegapi=1&bsv=o"},":signuphost:":"https://plus.google.com",plusone:{preloadUrl:["https://ssl.gstatic.com/s2/oz/images/stars/po/Publisher/sprite4-a67f741843ffc4220554c34bd01bb0bb.png"],params:{count:"",size:"",url:""},url:":socialhost:/:session_prefix:_/+1/fastbutton?bsv=o&usegapi=1"},comments:{methods:["scroll","openwindow"],params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/comments?bsv=o"},ytsubscribe:{url:"https://www.youtube.com/subscribe_embed?bsv=o&usegapi=1"}},isPlusUser:!0,debug:{host:"https://apis.google.com",reportExceptionRate:.05,rethrowException:!1},deviceType:"desktop",inline:{css:1},lexps:[102,98,99,111,79,109,72,45,17,117,86,115,81,95,122,61,30],"oauth-flow":{authAware:!0,eso:!1,disableOpt:!0,authUrl:"https://accounts.google.com/o/oauth2/auth",proxyUrl:"https://accounts.google.com/o/oauth2/postmessageRelay",toastCfg:"1000:3000:1000"},report:{host:"https://apis.google.com",rate:.001,apis:["iframes\\..*","gadgets\\..*","gapi\\.appcirclepicker\\.*","gapi\\.client\\..*"]},csi:{rate:.01},"googleapis.config":{}},h:"m;/_/scs/apps-static/_/js/k=oz.gapi.en.ED-YuaM3AT0.O/m=__features__/am=IQ/rt=j/d=1/rs=AItRSTNpo58QtV0_9nKV_7OZCUCDJsLsCg",u:"https://apis.google.com/js/client.js",hee:!0,fp:"faf8eead7e94f0277defa277558e8f85ed45c51f",dpo:!1},fp:"faf8eead7e94f0277defa277558e8f85ed45c51f",annotation:["interactivepost","recobar","autocomplete","profile"],bimodal:["signin"]}});